# Lumify GTD Ingest
---

This project provides ingest capability for the Global Terrorism Database (GTD) dataset for Lumify. It runs as
a standalone application.


## Importing GTD Data
---

1.  Download the [GTD](http://www.start.umd.edu/gtd/)
1.  Convert the desired Excel files to UTF-8 CSV files.  ([see below](#excelToUtf8))
1.	Run the `bin/importOntology.sh` script (depends on Lumify dev ontology already being loaded)
1.  Run the [`bin/importGtd.sh`](#importGtd) script


## [importGtd.sh](id:importGtd)
---

This script executes the GtdIngest application.  It accepts the following parameters:

*	`-d`

	Enables DEBUG mode.  The application will wait for a Java debugger to connect on
	port **12345** before executing.  You can configure the debug port by setting the
	environment variable `DEBUG_PORT` before executing the script.

	**This option must be the first parameter provided to the script.**

*	`--help`

	Displays a help message detailing the available options.

*	**`-i,--inputFile <file>` (required)**

	Specifies the UTF-8 CSV file to process.

*	`-m,--mapping <file>`

	An alternate JSON mapping definition for the GTD data. The default mapping is
	found in `src/main/resources/gtd.mapping.json`

*	`-v,--visibility <visibility>`

	The default visibility constraints for the ingested data. The default is no
	visibility restrictions (`""`).

**This script must be executed with the same version of Java as that running Lumify's ElasticSearch index.
This is Java 6 in the Lumify development and demo VMs. If there is a JVM mismatch, you will see ElasticSearch throw `TransportSerializationException` on ingest.**


## [Excel to UTF-8 CSV](id:excelToUtf8)
---

The GTD is distributed as a set of Excel files that need to be converted to CSV before Lumify can ingest them. The
`bin/make-utf8-csv.sh` script has been tested on OS X Mavericks and should work on most UNIX/Linux platforms. The
OS X version of `sed` does not support escape characters in regular expression replacements, so you must use this
script or another like it to convert the tab-separated file generated by Excel to a comma-separated file.

*	Open `${GTDFILE}.xls` in Excel
*	`Save As...`
	*	Change format to `UTF-16 Unicode Text (.txt)`
	*	Change filename to `${GTDFILE}.utf16.tsv`
*	`bin/make-utf8-csv.sh ${GTDFILE}.utf16.tsv ${GTDFILE}.utf8.csv`
