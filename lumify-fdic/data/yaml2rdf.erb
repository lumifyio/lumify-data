<?xml version="1.0"?>

<!DOCTYPE rdf:RDF [
        <!ENTITY owl "http://www.w3.org/2002/07/owl#" >
        <!ENTITY xsd "http://www.w3.org/2001/XMLSchema#" >
        <!ENTITY rdfs "http://www.w3.org/2000/01/rdf-schema#" >
        <!ENTITY rdf "http://www.w3.org/1999/02/22-rdf-syntax-ns#" >
        <!ENTITY fdic "http://lumify.io/fdic#">
        ]>


<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:lumify="http://lumify.io#"
         xmlns:fdic="http://lumify.io/fdic#">

    <rdf:Description rdf:about="&fdic;<%= resolution_plan[:id] %>">
        <rdf:type rdf:resource="&fdic;resolution-plan"/>
        <lumify:publishedDate><%= to_date(resolution_plan[:date]) %></lumify:publishedDate>
        <%- resolution_plan[:financial_institution_names].each do |name| -%>
        <fdic:financial-institution-name><%= parse_fi_name(name)[0] %></fdic:financial-institution-name>
        <%- end -%>
        <lumify:fileName><%= pdf_filename %></lumify:fileName>
        <lumify:raw>streamingValue:{"fileName": "<%= pdf_filename %>"}</lumify:raw>

        <!-- TODO: relationships -->
    </rdf:Description>

    <%- resolution_plan[:material_entities].each do |me_name, me_properties| -%>
    <rdf:Description rdf:about="&fdic;<%= me_properties[:id] %>">
        <rdf:type rdf:resource="&fdic;financial-institution"/>
        <fdic:financial-institution-name><%= me_name %></fdic:financial-institution-name>
        <%- if me_properties[:alias] -%>
        <fdic:alias><%= me_properties[:alias] %></fdic:alias>
        <%- end -%>
        <%- if me_properties[:image] -%>
        <lumify:entityImageVertexId><%= image_id(me_properties[:image]) %></lumify:entityImageVertexId>
        <fdic:thing-has-image rdf:resource="&fdic;<%= image_id(me_properties[:image]) %>"/>
        <%- end -%>

        <%- if me_properties[:resolution_plan_id] -%>
        <fdic:has-resolution-plan rdf:resource="&fdic;<%= me_properties[:resolution_plan_id] %>"/>
        <%- end -%>

        <!-- TODO: relationships -->
    </rdf:Description>

    <%- end -%>

    <%- resolution_plan[:financial_market_utilities].each do |fmu_name, fmu_properties| -%>
    <rdf:Description rdf:about="&fdic;<%= fmu_properties[:id] %>">
        <rdf:type rdf:resource="&fdic;financial-institution"/>
        <fdic:financial-institution-name><%=fmu_name %></fdic:financial-institution-name>
        <%- if fmu_properties[:alias] -%>
        <fdic:alias><%= fmu_properties[:alias] %></fdic:alias>
        <%- end -%>
        <%- if fmu_properties[:image] -%>
        <lumify:entityImageVertexId><%= image_id(fmu_properties[:image]) %></lumify:entityImageVertexId>
        <fdic:thing-has-image rdf:resource="&fdic;<%= image_id(fmu_properties[:image]) %>"/>
        <%- end -%>

        <!-- TODO: relationships -->
    </rdf:Description>

    <%- end -%>

    <%- resolution_plan[:principal_officers].each do |po_name, po_mes| -%>
    <rdf:Description rdf:about="&fdic;<%= person_id(po_name) %>">
        <rdf:type rdf:resource="&fdic;person"/>
        <lumify:title><%= po_name %></lumify:title>
        <%- if pos_mes[:image] -%>
        <lumify:fileName><%= pos_mes[:image] %></lumify:fileName>
        <lumify:raw>streamingValue:{"fileName": "people/<%= pos_mes[:image] %>"}</lumify:raw>
        <%- end -%>
    </rdf:Description>
    <%- po_mes[:orgs].each do |po_key, po_me|-%>
    <rdf:Description rdf:about="&fdic;<%= po_me[:id] %>">
        <rdf:type rdf:resource="&fdic;principal-officer-assignment"/>
        <lumify:title><%= po_name %></lumify:title>
        <%- po_me[:positions].each { |position| -%>
        <fdic:position><%= position %></fdic:position>
        <%- } -%>
        <fdic:principal-officer-assignment-out rdf:resource="&fdic;<%= person_id(po_name) %>"/>
    </rdf:Description>
    <%- end -%>

    <%- end -%>
</rdf:RDF>
